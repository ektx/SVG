<!DOCTYPE html><html><body><div class="webkit-line-gutter-backdrop"></div><table><tbody><tr><td class="webkit-line-number" value="1"></td><td class="webkit-line-content"><span class="webkit-html-doctype">&lt;!DOCTYPE html&gt;</span></td></tr><tr><td class="webkit-line-number" value="2"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;html&gt;</span></td></tr><tr><td class="webkit-line-number" value="3"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="4"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;head&gt;</span>  </td></tr><tr><td class="webkit-line-number" value="5"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;title&gt;</span>17 Animated Gears<span class="webkit-html-tag">&lt;/title&gt;</span></td></tr><tr><td class="webkit-line-number" value="6"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;meta <span class="webkit-html-attribute-name">http-equiv</span>="<span class="webkit-html-attribute-value">X-UA-Compatible</span>" <span class="webkit-html-attribute-name">content</span>="<span class="webkit-html-attribute-value">IE=Edge</span>"/&gt;</span> <span class="webkit-html-comment">&lt;!--  Remove this line in production. --&gt;</span></td></tr><tr><td class="webkit-line-number" value="7"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/head&gt;</span></td></tr><tr><td class="webkit-line-number" value="8"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="9"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;body&gt;</span></td></tr><tr><td class="webkit-line-number" value="10"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">style</span>="<span class="webkit-html-attribute-value">text-align: center;</span>"&gt;</span> <span class="webkit-html-comment">&lt;!-- Center everything. --&gt;</span></td></tr><tr><td class="webkit-line-number" value="11"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">style</span>="<span class="webkit-html-attribute-value"> margin-bottom: 8px;</span>"&gt;</span></td></tr><tr><td class="webkit-line-number" value="12"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;button <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">startButton</span>" <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">button</span>" <span class="webkit-html-attribute-name">onclick</span>="<span class="webkit-html-attribute-value">startAnim();</span>"&gt;</span></td></tr><tr><td class="webkit-line-number" value="13"></td><td class="webkit-line-content">        Start Animation</td></tr><tr><td class="webkit-line-number" value="14"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;/button&gt;</span> </td></tr><tr><td class="webkit-line-number" value="15"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number" value="16"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;svg <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">svgElement</span>" <span class="webkit-html-attribute-name">width</span>="<span class="webkit-html-attribute-value">800px</span>" <span class="webkit-html-attribute-name">height</span>="<span class="webkit-html-attribute-value">800px</span>" <span class="webkit-html-attribute-name">viewBox</span>="<span class="webkit-html-attribute-value">0 0 800 800</span>"&gt;</span> <span class="webkit-html-comment">&lt;!-- Give the svg element a name so that we can easily access it via JavaScript. --&gt;</span></td></tr><tr><td class="webkit-line-number" value="17"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;rect <span class="webkit-html-attribute-name">x</span>="<span class="webkit-html-attribute-value">0</span>" <span class="webkit-html-attribute-name">y</span>="<span class="webkit-html-attribute-value">0</span>" <span class="webkit-html-attribute-name">width</span>="<span class="webkit-html-attribute-value">100%</span>" <span class="webkit-html-attribute-name">height</span>="<span class="webkit-html-attribute-value">100%</span>" <span class="webkit-html-attribute-name">rx</span>="<span class="webkit-html-attribute-value">16</span>" <span class="webkit-html-attribute-name">ry</span>="<span class="webkit-html-attribute-value">16</span>" </span></td></tr><tr><td class="webkit-line-number" value="18"></td><td class="webkit-line-content">            <span class="webkit-html-attribute-name">style</span>="<span class="webkit-html-attribute-value">fill: none; stroke: black; stroke-dasharray: 10, 5;</span>" /&gt;</td></tr><tr><td class="webkit-line-number" value="19"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;g <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">coordinateFrame</span>" <span class="webkit-html-attribute-name">transform</span>="<span class="webkit-html-attribute-value">translate(400, 400)</span>"&gt;</span> <span class="webkit-html-comment">&lt;!-- Create a Cartesian coordinate system (with the y-axis flipped) for the animated gears. That is, place the origin at the center of the 800 x 800 SVG viewport: --&gt;</span></td></tr><tr><td class="webkit-line-number" value="20"></td><td class="webkit-line-content">        <span class="webkit-html-comment">&lt;!-- Gear &lt;g&gt; elements will be appended here via JavaScript. --&gt;</span></td></tr><tr><td class="webkit-line-number" value="21"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;/g&gt;</span></td></tr><tr><td class="webkit-line-number" value="22"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/svg&gt;</span></td></tr><tr><td class="webkit-line-number" value="23"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number" value="24"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;script&gt;</span></td></tr><tr><td class="webkit-line-number" value="25"></td><td class="webkit-line-content">    "use strict";</td></tr><tr><td class="webkit-line-number" value="26"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="27"></td><td class="webkit-line-content">    /* -- GLOBALS -------------------------------------------------------------------------------------------- */</td></tr><tr><td class="webkit-line-number" value="28"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="29"></td><td class="webkit-line-content">    var constants = {}; // Used to store global constants, see setConstants().</td></tr><tr><td class="webkit-line-number" value="30"></td><td class="webkit-line-content">    var gears = []; // An array that will contain the gears to be animated (plus additional information, such as gear position).</td></tr><tr><td class="webkit-line-number" value="31"></td><td class="webkit-line-content">    var requestAnimationFrameID;</td></tr><tr><td class="webkit-line-number" value="32"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="33"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="34"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="35"></td><td class="webkit-line-content">    document.addEventListener('DOMContentLoaded', setupGears, false); // Initialize the gears.</td></tr><tr><td class="webkit-line-number" value="36"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="37"></td><td class="webkit-line-content">    /* -- HELPER FUNCTIONS ----------------------------------------------------------------------------------- */</td></tr><tr><td class="webkit-line-number" value="38"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="39"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number" value="40"></td><td class="webkit-line-content">      Create a single global variable that contains all required constants.</td></tr><tr><td class="webkit-line-number" value="41"></td><td class="webkit-line-content">    */</td></tr><tr><td class="webkit-line-number" value="42"></td><td class="webkit-line-content">    function setConstants() {</td></tr><tr><td class="webkit-line-number" value="43"></td><td class="webkit-line-content">      constants.gearCrossBarColor = "white"; // The color of the vertical and horizontal lines on the circular gears.</td></tr><tr><td class="webkit-line-number" value="44"></td><td class="webkit-line-content">      constants.gearFontSize = 10; // Font size of the text displayed on the gears.</td></tr><tr><td class="webkit-line-number" value="45"></td><td class="webkit-line-content">      constants.driveGearIndex = 0; // The array index for the drive gear, which is the largest gear (labeled "#0"). All the other smaller gears are idler gears.</td></tr><tr><td class="webkit-line-number" value="46"></td><td class="webkit-line-content">      constants.driveGearAngularLimit = 360; // The total number of degrees to rotate the central drive gear, at which point the animation stops.</td></tr><tr><td class="webkit-line-number" value="47"></td><td class="webkit-line-content">      constants.driveGearSpeed = 0.3; // The amount, in degrees, to rotate the central drive gear about every 16.7 milliseconds (this speed value, of course, affects the speed of all the idler gears).</td></tr><tr><td class="webkit-line-number" value="48"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="49"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="50"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="51"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="52"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number" value="53"></td><td class="webkit-line-content">      Returns true if the browser supports HTML5 with inline SVG, false otherwise. Assumes that the root SVG</td></tr><tr><td class="webkit-line-number" value="54"></td><td class="webkit-line-content">      element has an ID value of "svgElement".</td></tr><tr><td class="webkit-line-number" value="55"></td><td class="webkit-line-content">    */</td></tr><tr><td class="webkit-line-number" value="56"></td><td class="webkit-line-content">    function svgSupported() {</td></tr><tr><td class="webkit-line-number" value="57"></td><td class="webkit-line-content">      return (svgElement.namespaceURI == "http://www.w3.org/2000/svg");</td></tr><tr><td class="webkit-line-number" value="58"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="59"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="60"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="61"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="62"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number" value="63"></td><td class="webkit-line-content">      Returns and RBG color value string, as in "rgb(120, 70, 255)". Stay away from overly dark and light</td></tr><tr><td class="webkit-line-number" value="64"></td><td class="webkit-line-content">      colors. That is, we avoid RGB values below 60 (i.e., too dark) and RGB values above 230 (i.e., too light).</td></tr><tr><td class="webkit-line-number" value="65"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="66"></td><td class="webkit-line-content">      Note that Math.floor( Math.random() * 171 ) generates a random integer between 0 and 170. Thus, adding</td></tr><tr><td class="webkit-line-number" value="67"></td><td class="webkit-line-content">      60 to this range gives you a random integer between 60 and 230.</td></tr><tr><td class="webkit-line-number" value="68"></td><td class="webkit-line-content">    */</td></tr><tr><td class="webkit-line-number" value="69"></td><td class="webkit-line-content">    function getRandomColor() {</td></tr><tr><td class="webkit-line-number" value="70"></td><td class="webkit-line-content">      var randomColor1 = Math.floor(Math.random() * 171) + 60; // Generates a random integer between 60 and 230.</td></tr><tr><td class="webkit-line-number" value="71"></td><td class="webkit-line-content">      var randomColor2 = Math.floor(Math.random() * 171) + 60;</td></tr><tr><td class="webkit-line-number" value="72"></td><td class="webkit-line-content">      var randomColor3 = Math.floor(Math.random() * 171) + 60;</td></tr><tr><td class="webkit-line-number" value="73"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="74"></td><td class="webkit-line-content">      return ("rgb(" + randomColor1 + ", " + randomColor2 + ", " + randomColor3 + ")");</td></tr><tr><td class="webkit-line-number" value="75"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="76"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="77"></td><td class="webkit-line-content">    /* -- ANIMATION SETUP FUNCTIONS -------------------------------------------------------------------------- */</td></tr><tr><td class="webkit-line-number" value="78"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="79"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number" value="80"></td><td class="webkit-line-content">      Assumes that this function is called after the page loads.</td></tr><tr><td class="webkit-line-number" value="81"></td><td class="webkit-line-content">    */</td></tr><tr><td class="webkit-line-number" value="82"></td><td class="webkit-line-content">    function initializeGearsArray() {</td></tr><tr><td class="webkit-line-number" value="83"></td><td class="webkit-line-content">      gears =</td></tr><tr><td class="webkit-line-number" value="84"></td><td class="webkit-line-content">      [</td></tr><tr><td class="webkit-line-number" value="85"></td><td class="webkit-line-content">        { r: 200, x: 0, y: 0, clockwise: +1 },</td></tr><tr><td class="webkit-line-number" value="86"></td><td class="webkit-line-content">        { r: 75, x: 275, y: 0, clockwise: -1 },</td></tr><tr><td class="webkit-line-number" value="87"></td><td class="webkit-line-content">        { r: 37.5, x: 275, y: 112.5, clockwise: +1 },</td></tr><tr><td class="webkit-line-number" value="88"></td><td class="webkit-line-content">        { r: 125, x: 275, y: 275, clockwise: -1 },</td></tr><tr><td class="webkit-line-number" value="89"></td><td class="webkit-line-content">        { r: 37.5, x: 112.5, y: 275, clockwise: +1 },</td></tr><tr><td class="webkit-line-number" value="90"></td><td class="webkit-line-content">        { r: 75, x: 0, y: 275, clockwise: -1 },</td></tr><tr><td class="webkit-line-number" value="91"></td><td class="webkit-line-content">        { r: 37.5, x: -112.5, y: 275, clockwise: +1 },</td></tr><tr><td class="webkit-line-number" value="92"></td><td class="webkit-line-content">        { r: 125, x: -275, y: 275, clockwise: -1 },</td></tr><tr><td class="webkit-line-number" value="93"></td><td class="webkit-line-content">        { r: 37.5, x: -275, y: 112.5, clockwise: +1 },</td></tr><tr><td class="webkit-line-number" value="94"></td><td class="webkit-line-content">        { r: 75, x: -275, y: 0, clockwise: -1 },</td></tr><tr><td class="webkit-line-number" value="95"></td><td class="webkit-line-content">        { r: 37.5, x: -275, y: -112.5, clockwise: +1 },</td></tr><tr><td class="webkit-line-number" value="96"></td><td class="webkit-line-content">        { r: 125, x: -275, y: -275, clockwise: -1 },</td></tr><tr><td class="webkit-line-number" value="97"></td><td class="webkit-line-content">        { r: 37.5, x: -112.5, y: -275, clockwise: +1 },</td></tr><tr><td class="webkit-line-number" value="98"></td><td class="webkit-line-content">        { r: 75, x: 0, y: -275, clockwise: -1 },</td></tr><tr><td class="webkit-line-number" value="99"></td><td class="webkit-line-content">        { r: 37.5, x: 112.5, y: -275, clockwise: +1 },</td></tr><tr><td class="webkit-line-number" value="100"></td><td class="webkit-line-content">        { r: 125, x: 275, y: -275, clockwise: -1 },</td></tr><tr><td class="webkit-line-number" value="101"></td><td class="webkit-line-content">        { r: 37.5, x: 275, y: -112.5, clockwise: +1 }</td></tr><tr><td class="webkit-line-number" value="102"></td><td class="webkit-line-content">      ]; // Define the radius of each gear, its center, and its normal direction of rotation.</td></tr><tr><td class="webkit-line-number" value="103"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="104"></td><td class="webkit-line-content">      for (var i = 0; i &lt; gears.length; i++) {</td></tr><tr><td class="webkit-line-number" value="105"></td><td class="webkit-line-content">        gears[i].index = i; // A gear object should know what gear it is.</td></tr><tr><td class="webkit-line-number" value="106"></td><td class="webkit-line-content">        gears[i].name = "gear" + i; // The ID name used for each gear &lt;g&gt; group.</td></tr><tr><td class="webkit-line-number" value="107"></td><td class="webkit-line-content">        gears[i].currentAngle = 0; // All gears start out with 0 degrees of initial rotation.</td></tr><tr><td class="webkit-line-number" value="108"></td><td class="webkit-line-content">        gears[i].color = getRandomColor(); // A gear's color.</td></tr><tr><td class="webkit-line-number" value="109"></td><td class="webkit-line-content">        gears[i].circleName = "gearCircle" + i; // This information is needed so that we can reset the gear colors when the Reset button is pressed.</td></tr><tr><td class="webkit-line-number" value="110"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number" value="111"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="112"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="113"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="114"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="115"></td><td class="webkit-line-content">    function appendGearGElement(gear) {</td></tr><tr><td class="webkit-line-number" value="116"></td><td class="webkit-line-content">      var gearGElement; // Each gear &lt;g&gt; element will contain all the graphics required for a gear, and said &lt;g&gt; element will be named "gear0", "gear1", "gear2", etc.</td></tr><tr><td class="webkit-line-number" value="117"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="118"></td><td class="webkit-line-content">      gearGElement = document.createElementNS("http://www.w3.org/2000/svg", "g"); // Create a generic SVG &lt;g&gt; element.</td></tr><tr><td class="webkit-line-number" value="119"></td><td class="webkit-line-content">      gearGElement.id = gear.name; // This is a gear object that will be animated.</td></tr><tr><td class="webkit-line-number" value="120"></td><td class="webkit-line-content">      coordinateFrame.appendChild(gearGElement); // Append the gear object to the coordinate frame element.</td></tr><tr><td class="webkit-line-number" value="121"></td><td class="webkit-line-content">      return (gearGElement); // Return the &lt;g&gt; element object so that other gear graphic elements can be attached to it later on.</td></tr><tr><td class="webkit-line-number" value="122"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="123"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="124"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="125"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="126"></td><td class="webkit-line-content">    function appendGearCircleElement(gear, appendElement) {</td></tr><tr><td class="webkit-line-number" value="127"></td><td class="webkit-line-content">      var gearCircleElement; // The basic shape of a gear is a colored circle.</td></tr><tr><td class="webkit-line-number" value="128"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="129"></td><td class="webkit-line-content">      gearCircleElement = document.createElementNS("http://www.w3.org/2000/svg", "circle");</td></tr><tr><td class="webkit-line-number" value="130"></td><td class="webkit-line-content">      gearCircleElement.id = gear.circleName;</td></tr><tr><td class="webkit-line-number" value="131"></td><td class="webkit-line-content">      gearCircleElement.cx.baseVal.value = gear.x;</td></tr><tr><td class="webkit-line-number" value="132"></td><td class="webkit-line-content">      gearCircleElement.cy.baseVal.value = gear.y;</td></tr><tr><td class="webkit-line-number" value="133"></td><td class="webkit-line-content">      gearCircleElement.r.baseVal.value = gear.r;</td></tr><tr><td class="webkit-line-number" value="134"></td><td class="webkit-line-content">      gearCircleElement.style.fill = gear.color;</td></tr><tr><td class="webkit-line-number" value="135"></td><td class="webkit-line-content">      appendElement.appendChild(gearCircleElement); // Append this gear circle to its containing &lt;g&gt; element.</td></tr><tr><td class="webkit-line-number" value="136"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="137"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="138"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="139"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="140"></td><td class="webkit-line-content">    function appendGearCrossbarElements(gear, appendElement) {</td></tr><tr><td class="webkit-line-number" value="141"></td><td class="webkit-line-content">      var gearLineElement; // Represents a horizontal or vertical line on the gear surface.</td></tr><tr><td class="webkit-line-number" value="142"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="143"></td><td class="webkit-line-content">      gearLineElement = document.createElementNS("http://www.w3.org/2000/svg", "line");</td></tr><tr><td class="webkit-line-number" value="144"></td><td class="webkit-line-content">      gearLineElement.id = "gearHLine" + gear.index;</td></tr><tr><td class="webkit-line-number" value="145"></td><td class="webkit-line-content">      gearLineElement.x1.baseVal.value = gear.x - gear.r;</td></tr><tr><td class="webkit-line-number" value="146"></td><td class="webkit-line-content">      gearLineElement.y1.baseVal.value = gear.y;</td></tr><tr><td class="webkit-line-number" value="147"></td><td class="webkit-line-content">      gearLineElement.x2.baseVal.value = gear.x + gear.r;</td></tr><tr><td class="webkit-line-number" value="148"></td><td class="webkit-line-content">      gearLineElement.y2.baseVal.value = gear.y;</td></tr><tr><td class="webkit-line-number" value="149"></td><td class="webkit-line-content">      gearLineElement.style.stroke = "white";</td></tr><tr><td class="webkit-line-number" value="150"></td><td class="webkit-line-content">      appendElement.appendChild(gearLineElement);</td></tr><tr><td class="webkit-line-number" value="151"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="152"></td><td class="webkit-line-content">      gearLineElement = document.createElementNS("http://www.w3.org/2000/svg", "line");</td></tr><tr><td class="webkit-line-number" value="153"></td><td class="webkit-line-content">      gearLineElement.id = "gearVLine" + gear.index;</td></tr><tr><td class="webkit-line-number" value="154"></td><td class="webkit-line-content">      gearLineElement.x1.baseVal.value = gear.x;</td></tr><tr><td class="webkit-line-number" value="155"></td><td class="webkit-line-content">      gearLineElement.y1.baseVal.value = gear.y - gear.r;</td></tr><tr><td class="webkit-line-number" value="156"></td><td class="webkit-line-content">      gearLineElement.x2.baseVal.value = gear.x;</td></tr><tr><td class="webkit-line-number" value="157"></td><td class="webkit-line-content">      gearLineElement.y2.baseVal.value = gear.y + gear.r;</td></tr><tr><td class="webkit-line-number" value="158"></td><td class="webkit-line-content">      gearLineElement.style.stroke = constants.gearCrossBarColor;</td></tr><tr><td class="webkit-line-number" value="159"></td><td class="webkit-line-content">      appendElement.appendChild(gearLineElement);</td></tr><tr><td class="webkit-line-number" value="160"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="161"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="162"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="163"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="164"></td><td class="webkit-line-content">    /*</td></tr><tr><td class="webkit-line-number" value="165"></td><td class="webkit-line-content">      For comparison purposes, this function uses DOM L2 scripting.</td></tr><tr><td class="webkit-line-number" value="166"></td><td class="webkit-line-content">    */</td></tr><tr><td class="webkit-line-number" value="167"></td><td class="webkit-line-content">    function appendGearTextElements(gear, appendElement) {</td></tr><tr><td class="webkit-line-number" value="168"></td><td class="webkit-line-content">      var gearTextElement;</td></tr><tr><td class="webkit-line-number" value="169"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="170"></td><td class="webkit-line-content">      gearTextElement = document.createElementNS("http://www.w3.org/2000/svg", "text");</td></tr><tr><td class="webkit-line-number" value="171"></td><td class="webkit-line-content">      gearTextElement.id = "gearNumberText" + gear.index;</td></tr><tr><td class="webkit-line-number" value="172"></td><td class="webkit-line-content">      gearTextElement.setAttribute("x", gear.x);</td></tr><tr><td class="webkit-line-number" value="173"></td><td class="webkit-line-content">      gearTextElement.setAttribute("y", gear.y);</td></tr><tr><td class="webkit-line-number" value="174"></td><td class="webkit-line-content">      gearTextElement.setAttribute("transform", "translate(3, -3)"); // Offset the text from the center of the circle.</td></tr><tr><td class="webkit-line-number" value="175"></td><td class="webkit-line-content">      gearTextElement.textContent = "#" + gear.index;</td></tr><tr><td class="webkit-line-number" value="176"></td><td class="webkit-line-content">      gearTextElement.setAttribute("font-size", constants.gearFontSize);</td></tr><tr><td class="webkit-line-number" value="177"></td><td class="webkit-line-content">      appendElement.appendChild(gearTextElement);</td></tr><tr><td class="webkit-line-number" value="178"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="179"></td><td class="webkit-line-content">      gearTextElement = document.createElementNS("http://www.w3.org/2000/svg", "text");</td></tr><tr><td class="webkit-line-number" value="180"></td><td class="webkit-line-content">      gearTextElement.id = "gearRadiusText" + gear.index;</td></tr><tr><td class="webkit-line-number" value="181"></td><td class="webkit-line-content">      gearTextElement.setAttribute("x", gear.x);</td></tr><tr><td class="webkit-line-number" value="182"></td><td class="webkit-line-content">      gearTextElement.setAttribute("y", gear.y);</td></tr><tr><td class="webkit-line-number" value="183"></td><td class="webkit-line-content">      gearTextElement.setAttribute("transform", "translate(3, 10)");</td></tr><tr><td class="webkit-line-number" value="184"></td><td class="webkit-line-content">      gearTextElement.textContent = "r = " + gear.r;</td></tr><tr><td class="webkit-line-number" value="185"></td><td class="webkit-line-content">      gearTextElement.setAttribute("font-size", constants.gearFontSize);</td></tr><tr><td class="webkit-line-number" value="186"></td><td class="webkit-line-content">      appendElement.appendChild(gearTextElement);</td></tr><tr><td class="webkit-line-number" value="187"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="188"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="189"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="190"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="191"></td><td class="webkit-line-content">    function createGearElements() {</td></tr><tr><td class="webkit-line-number" value="192"></td><td class="webkit-line-content">      var gearGElement;</td></tr><tr><td class="webkit-line-number" value="193"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="194"></td><td class="webkit-line-content">      for (var i = 0; i &lt; gears.length; i++) {</td></tr><tr><td class="webkit-line-number" value="195"></td><td class="webkit-line-content">        gearGElement = appendGearGElement(gears[i]); // Create a named &lt;g&gt; element and append it to the "coordinateFrame" element.</td></tr><tr><td class="webkit-line-number" value="196"></td><td class="webkit-line-content">        appendGearCircleElement(gears[i], gearGElement); // Create a named &lt;circle&gt; element, representing part of a gear, and attach it to the "gearGElement" group.</td></tr><tr><td class="webkit-line-number" value="197"></td><td class="webkit-line-content">        appendGearCrossbarElements(gears[i], gearGElement); // Now add the crossbars to a gear &lt;g&gt; group.</td></tr><tr><td class="webkit-line-number" value="198"></td><td class="webkit-line-content">        appendGearTextElements(gears[i], gearGElement); // And finally print some useful info onto the surface of the gear.</td></tr><tr><td class="webkit-line-number" value="199"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number" value="200"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="201"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="202"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="203"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="204"></td><td class="webkit-line-content">    function loadGearsArray() {</td></tr><tr><td class="webkit-line-number" value="205"></td><td class="webkit-line-content">      var transformObject = svgElement.createSVGTransform(); // Create a generic SVG transform object so as to gain access to its methods and properties, such as setRotate().;</td></tr><tr><td class="webkit-line-number" value="206"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="207"></td><td class="webkit-line-content">      for (var i = 0; i &lt; gears.length; i++) {</td></tr><tr><td class="webkit-line-number" value="208"></td><td class="webkit-line-content">        gears[i].obj = document.getElementById(gears[i].name); // Acquire the gear object (i.e., the &lt;g&gt; element) associated with the given gear element ID name. This gear object will be incrementally rotated at a given center point.</td></tr><tr><td class="webkit-line-number" value="209"></td><td class="webkit-line-content">        gears[i].obj.transform.baseVal.appendItem(transformObject); // Append a transform object to a gear, now the gear object has inherited all the transform object's goodness such as access to the method setRotate().</td></tr><tr><td class="webkit-line-number" value="210"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number" value="211"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="212"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="213"></td><td class="webkit-line-content">    /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */</td></tr><tr><td class="webkit-line-number" value="214"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="215"></td><td class="webkit-line-content">    function setupGears() {</td></tr><tr><td class="webkit-line-number" value="216"></td><td class="webkit-line-content">      if (!svgSupported()) // Bail if the browser doesn't support HTML5 with inline SVG.</td></tr><tr><td class="webkit-line-number" value="217"></td><td class="webkit-line-content">      {</td></tr><tr><td class="webkit-line-number" value="218"></td><td class="webkit-line-content">        alert("Inline SVG in HTML5 is not supported. This document requires a browser that supports HTML5 and inline SVG.");</td></tr><tr><td class="webkit-line-number" value="219"></td><td class="webkit-line-content">        return;</td></tr><tr><td class="webkit-line-number" value="220"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number" value="221"></td><td class="webkit-line-content">      setConstants(); // Add all required constant values to the global "constants".</td></tr><tr><td class="webkit-line-number" value="222"></td><td class="webkit-line-content">      initializeGearsArray(); // Add basic gear information, such as gear location and size.</td></tr><tr><td class="webkit-line-number" value="223"></td><td class="webkit-line-content">      createGearElements(); // Creates gear related elements and inserts them into the DOM.</td></tr><tr><td class="webkit-line-number" value="224"></td><td class="webkit-line-content">      loadGearsArray(); // This must be called after createGearElements(). These gear &lt;g&gt; elements will be incrementally rotated when animated.</td></tr><tr><td class="webkit-line-number" value="225"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="226"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="227"></td><td class="webkit-line-content">    /* -- ANIMATION FUNCTIONS -------------------------------------------------------------------------------- */</td></tr><tr><td class="webkit-line-number" value="228"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="229"></td><td class="webkit-line-content">    function startAnim() {</td></tr><tr><td class="webkit-line-number" value="230"></td><td class="webkit-line-content">      if (!startButton.startButtonClicked) // Don't allow multiple instance of the function specified by requestAnimationFrame to be invoked by the browser. Note that button.startButtonClicked will be undefined on first use, which is effectively the same as false.</td></tr><tr><td class="webkit-line-number" value="231"></td><td class="webkit-line-content">      {</td></tr><tr><td class="webkit-line-number" value="232"></td><td class="webkit-line-content">        /* Only do the following once per full animation: */</td></tr><tr><td class="webkit-line-number" value="233"></td><td class="webkit-line-content">        startButton.startButtonClicked = true; // A custom property is attached to the button object to track whether the button has been clicked or not.</td></tr><tr><td class="webkit-line-number" value="234"></td><td class="webkit-line-content">        requestAnimationFrameID = requestAnimationFrame(doAnim); // Start the animation loop.</td></tr><tr><td class="webkit-line-number" value="235"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number" value="236"></td><td class="webkit-line-content">    }</td></tr><tr><td class="webkit-line-number" value="237"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="238"></td><td class="webkit-line-content">    function doAnim() {</td></tr><tr><td class="webkit-line-number" value="239"></td><td class="webkit-line-content">      if (gears[constants.driveGearIndex].currentAngle &gt; constants.driveGearAngularLimit) // Stop the animation after the drive gear rotates driveGearAngularLimit number of degrees.</td></tr><tr><td class="webkit-line-number" value="240"></td><td class="webkit-line-content">      {</td></tr><tr><td class="webkit-line-number" value="241"></td><td class="webkit-line-content">        cancelAnimationFrame(requestAnimationFrameID); // Instruct the browser to stop calling requestAnimationFrame()'s callback.</td></tr><tr><td class="webkit-line-number" value="242"></td><td class="webkit-line-content">        startButton.startButtonClicked = false; // Let the user run the animation again if they choose.</td></tr><tr><td class="webkit-line-number" value="243"></td><td class="webkit-line-content">        gears[constants.driveGearIndex].currentAngle = 0; // Set the drive gear up for another spin if the user clicks the Start Animation button.</td></tr><tr><td class="webkit-line-number" value="244"></td><td class="webkit-line-content">        return; // We have completed our animation, time to quit.</td></tr><tr><td class="webkit-line-number" value="245"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number" value="246"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="247"></td><td class="webkit-line-content">      for (var i = 0; i &lt; gears.length; i++) {</td></tr><tr><td class="webkit-line-number" value="248"></td><td class="webkit-line-content">        gears[i].obj.transform.baseVal.getItem(0).setRotate(gears[i].currentAngle, gears[i].x, gears[i].y); // Rotate the i'th gear about the gear's center point.</td></tr><tr><td class="webkit-line-number" value="249"></td><td class="webkit-line-content">        // gears[i].obj.setAttribute("transform", "rotate(" + gears[i].currentAngle + ", " + gears[i].x + ", " + gears[i].y + ")"); // More cross-browser friendly, slightly less performant. Note that you don't technically need to append a transform object to each gear object, in loadGearsArray(), when using this line.</td></tr><tr><td class="webkit-line-number" value="250"></td><td class="webkit-line-content">        gears[i].currentAngle += (gears[i].clockwise * constants.driveGearSpeed * (gears[constants.driveGearIndex].r / gears[i].r)); // Calculate the appropriate rotational speed of the gear based on it's radius.</td></tr><tr><td class="webkit-line-number" value="251"></td><td class="webkit-line-content"></td></tr><tr><td class="webkit-line-number" value="252"></td><td class="webkit-line-content">        if (gears[i].currentAngle &gt;= (constants.driveGearAngularLimit + 360)) // Don't let "currentAngle" get crazy big.</td></tr><tr><td class="webkit-line-number" value="253"></td><td class="webkit-line-content">          gears[i].currentAngle -= 360; // Keeps "currentAngle" between 0 and a non-crazy value.</td></tr><tr><td class="webkit-line-number" value="254"></td><td class="webkit-line-content">      }</td></tr><tr><td class="webkit-line-number" value="255"></td><td class="webkit-line-content">      requestAnimationFrameID = requestAnimationFrame(doAnim); // Call the doAnim() function about every 16.7 milliseconds (i.e., about 60 frames per second).</td></tr><tr><td class="webkit-line-number" value="256"></td><td class="webkit-line-content">    } // doAnim()</td></tr><tr><td class="webkit-line-number" value="257"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number" value="258"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/body&gt;</span></td></tr><tr><td class="webkit-line-number" value="259"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/html&gt;</span></td></tr></tbody></table></body></html>